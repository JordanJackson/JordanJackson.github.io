<!DOCTYPE html>

<html>
	<head>
		<title>Simple Animated Three.js Scene with dat.gui Controls</title>
		<script type="text/javascript" src="libs/dat.gui.min.js"></script>
		<script type="text/javascript" src="libs/three.js"></script>
		<script type="text/javascript" src="libs/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="libs/stats.min.js"></script>
		<script type="text/javascript" src="effects/AsciiEffect.js"></script>
		<style>
			 body {
			 	/* set margin to 0 and overflow to hidden to use complete pade */
			 	margin: 0;
			 	overflow: hidden;
			 }
		</style>
	</head>
	<body>
		<div id="Stats-output">
		</div>
		<!-- div which will hold the output -->
		<div id="WebGL-output">
		</div>

		<!-- Javascript code that runs our Three.js examples -->
		<script type="text/javascript">
		// once everything is loaded, we run our Three.js stuff.
			// once everything is loaded, we run our Three.js stuff.
		    $(function () {
		    	var stats = initStats();

		    	

		        // create a scene, that will hold all our elements such as objects, cameras and lights.
		        var scene = new THREE.Scene();
		        // create a camera, which defines where we're looking at.
		        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
		        // create a render and set the size
		        var renderer = new THREE.WebGLRenderer();

		        renderer.setClearColor(new THREE.Color(0xEEEEEE, 1.0));
		        renderer.setSize(window.innerWidth, window.innerHeight);
		        renderer.shadowMapEnabled = true;


		        var axes = new THREE.AxisHelper( 20 );
		        scene.add(axes);
		        // create the ground plane
		        var planeGeometry = new THREE.PlaneGeometry(60,20);
		        var planeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff});
		        var plane = new THREE.Mesh(planeGeometry,planeMaterial);
		        plane.receiveShadow = true;
		        // rotate and position the plane
		        plane.rotation.x=-0.5*Math.PI;
		        plane.position.x=15
		        plane.position.y=0
		        plane.position.z=0
		        // add the plane to the scene
		        scene.add(plane);
		        // create a cube
		        var cubeGeometry = new THREE.CubeGeometry(4,4,4);
		        var cubeMaterial = new THREE.MeshLambertMaterial({color: 0xff0000});
		        var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
		        cube.castShadow = true;
		        // position the cube
		        cube.position.x=-4;
		        cube.position.y=3;
		        cube.position.z=0;
		        // add the cube to the scene
		        scene.add(cube);
		        var sphereGeometry = new THREE.SphereGeometry(4,20,20);
		        var sphereMaterial = new THREE.MeshLambertMaterial({color: 0x7777ff});
		        var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
		        sphere.castShadow = true;
		        // position the sphere
		        sphere.position.x=20;
		        sphere.position.y=4;
		        sphere.position.z=2;
		        // add the sphere to the scene
		        scene.add(sphere);
		        // position and point the camera to the center of the scene
		        camera.position.x = -30;
		        camera.position.y = 40;
		        camera.position.z = 30;
		        camera.lookAt(scene.position);

		        // add spotlight for shadows
		        var spotLight = new THREE.SpotLight(0xffffff);
		        spotLight.position.set( -40, 60, -10);
		        spotLight.castShadow = true;
		        scene.add(spotLight);

		        // call the render function
		        var step = 0;

		        var controls = new function() {
		        	this.rotationSpeed = 0.02;
		        	this.bouncingSpeed = 0.03;
		        	//this.asciiEffect = false;
		        }

		        var gui = new dat.GUI;
		        gui.add(controls, 'rotationSpeed', 0, 0.5);
		        gui.add(controls, 'bouncingSpeed', 0, 0.5);
		        //gui.add(controls, 'asciiEffect');

		        /* // Code for ASCII effect
	        	var effect = new THREE.AsciiEffect( renderer );
		        effect.setSize( window.innerWidth, window.innerHeight );
		        // add the output of the renderer to the html element
		        $("#WebGL-output").append(effect.domElement);
	        	*/
	        	// add the output of the renderer to the html element
	        	$("#WebGL-output").append(renderer.domElement);
		        

		        renderScene();

		        function renderScene() {        	
		        	stats.update();

		        	//--- Update state of objects in Scene ---//

		        	// rotate cube
		        	cube.rotation.x += controls.rotationSpeed;
		        	cube.rotation.y += controls.rotationSpeed;
		        	cube.rotation.z += controls.rotationSpeed;

		        	// bounce sphere up and down
		        	step += controls.bouncingSpeed;
		        	sphere.position.x = 20 + (10*(Math.cos(step)));
		        	sphere.position.y = 2 + (10*Math.abs(Math.sin(step)));

		        	// render using requestAnimationFrame
		        	requestAnimationFrame(renderScene);

		        	/* // code for ASCII effect rendering
					effect.render(scene, camera);
					*/
		        	// render the scene
		        	renderer.render(scene, camera);

		        }
		        
		        function initStats() {
		        	var stats = new Stats();
		        	stats.setMode(0);
		        	stats.domElement.style.position = 'absolute';
		        	stats.domElement.style.left = '0px';
		        	stats.domElement.style.top = '0px';
		        	$("#Stats-output").append(stats.domElement);
		        	return stats;
		        }
		    });
		</script>
	</body>
</html>